---
title: "Historical Ethereum Price Exploratory Data Analysis"
output: html_notebook
---

Load necessary libraries:
```{r}
library(tidyverse);
library(crypto);
library(zoo);
```

#Import Data

Import data with `crypto` package using my function `GetCoinHistory()` from the `gatherData.R` file:
```{r}
data <- GetCoinHistory("ETH")
```

#Organize Data Using my .R Functions
Add 10 and 50 day moving average of open prices with my function `mutateRoll()` from the `mutateData.R` file:
```{r}
data <- mutateRoll(data,data$open,c(10,50))
```

Add Yesterday's open and close price to data with my function `mutateLast()` from the `mutateData.R` file:
```{r}
data <- mutateLast(data,data$open,"openLast")
data <- mutateLast(data,data$close,"closeLast")
```

Add Tomorrow's open price to data with my function `mutateNext()` from the `mutateData.R` file:
```{r}
data <- mutateNext(data,data$open,"openNext")
data <- mutateNext(data,data$close,"closeNext")
data <- mutateNext(data,data$high,"highNext")
```

Add a ratio of yesterday's and today's values with my function `mutateLastRatio()` from the `mutateData.R` file:
```{r}
data <- mutateLastRatio(data,data$openLast,data$open,"openRatioLast")
data <- mutateLastRatio(data,data$closeLast,data$close,"closeRatioLast")
```

Add a ratio of today's and tomorrow's values with my function `mutateNextRatio()` from the `mutateData.R` file:
```{r}
data <- mutateLastRatio(data,data$open,data$openNext,"openRatioNext")
data <- mutateLastRatio(data,data$close,data$closeNext,"closeRatioNext")
data <- mutateLastRatio(data,data$low,data$highNext,"maxIncrease")
```

These values, the open and close price for tomorrow's market, will serve as the training values for our model.

#Plot Data
I have written four plotting functions in my `plotData.R` file:
`plotOpen()`, `plotClose()`, `plotHigh()`, `plotLow()`

```{r}
plotOpen(data)
plotClose(data)
plotHigh(data)
plotLow(data)
```

#Moving Forward w/ Model
Now that the data has moving averages as well as past and previous values for open and close, it can be implemented in the form of a model. 
Yesterday's open, yesterday's close, today's open, today's close, historically the open and close of the next day, 10-day moving averages and 50-day moving averages can now be predictors used in the model, which could have a variety of useful outputs in trading. Namely, the difference between tomorrow's open and close values would be a useful prediction for traders, because it would indicate a predicted large shift in the market.

#Fitting a Model to Data

##Linear Model
Create training and test sets using my function in `modelData.R`.
```{r}
#Add a boolean variable of whether the close price tomorrow will be greater than today's open.
data <- mutate(data, increase = (closeNext>open))
#*******
data_train <- sample_n(data,800)
data_test <- sample_n(data,250)
```

Now, fit a glm with a variety of different predictors.
```{r}
data_glm <- glm(data=data_train, openNext ~ open+openRatioNext*close)
#summary(data_glm)

prediction <- predict(data_glm,newdata = data_test,type="response")

#temp <- table((prediction/data_test$openNext)>0.90 & 
#        (prediction/data_test$openNext)<1.1)

#as.numeric(temp[1]/temp[2]*100)

#ggplot(data = data.frame(cbind(data_test,prediction)),mapping = aes(x=prediction,y=highNext)) + geom_point() + geom_smooth()

avgGLM(100,100,100,data)
```




















